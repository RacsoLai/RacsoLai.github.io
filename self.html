<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>民宿永續旅遊成熟度自評工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js for Radar Chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- QRCode.js for QR Code generation -->
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
    <!-- html2canvas for capturing DOM as image -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>

        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f0f7f4;
            /* Adjusted padding-top to compensate for fixed top navbar */
            padding-top: 64px; /* Adjusted as progress bar section moved out */
            /* Adjusted padding-bottom to compensate for fixed bottom navbar (now taller) */
            padding-bottom: 140px; /* Increased to accommodate new content */
        }
        
        .progress-bar {
            height: 8px;
            transition: width 0.3s ease;
        }
        
        .category-card {
            transition: all 0.3s ease;
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .indicator-card {
            transition: all 0.2s ease;
        }
        
        .indicator-card:hover {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }

        /* Base style for score buttons (square with slight rounding) */
        .score-btn {
            width: 36px; /* Adjusted size for square buttons */
            height: 36px; /* Adjusted size for square buttons */
            border-radius: 0.25rem; /* Make them slightly rounded squares */
            background-color: #f3f4f6; /* gray-100 as default background */
            color: #4b5563; /* gray-700 as default text color */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 1px solid #d1d5db; /* gray-300 border */
        }

        /* Override for circular buttons - REMOVED as per request, but keeping class for now if needed elsewhere */
        .score-btn-round {
            border-radius: 0.25rem; /* Reverted to square */
        }
        
        /* Hover styles for each score button, matching the web.html colors for visual feedback */
        .score-btn[data-score="0"]:hover { background-color: #fee2e2; color: #b91c1c; } /* red-100 */
        .score-btn[data-score="1"]:hover { background-color: #ffedd5; color: #ea580c; } /* orange-100 */
        .score-btn[data-score="2"]:hover { background-color: #fffbeb; color: #ca8a04; } /* yellow-100 */
        .score-btn[data-score="3"]:hover { background-color: #ecfccb; color: #65a30d; } /* lime-100 */
        .score-btn[data-score="4"]:hover { background-color: #d1fae5; color: #047857; } /* green-100 */

        /* Selected styles: color, transform, and box-shadow. Background and border color will be set by JS. */
        .score-btn.selected {
            color: white; /* White text for selected buttons */
            transform: scale(1.1); /* Slightly enlarge selected button */
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            /* REMOVED: background-color and border-color from here to allow JS to control them dynamically */
        }

        /* Table styles */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1.5rem;
        }
        th, td {
            border: 1px solid #e2e8f0; /* gray-200 */
            padding: 0.75rem;
            text-align: left;
        }
        th {
            background-color: #f7fafc; /* gray-100 */
            font-weight: 600;
            color: #4a5568; /* gray-700 */
        }
        tr:nth-child(even) {
            background-color: #edf2f7; /* gray-200 */
        }
        tr:hover {
            background-color: #e2e8f0; /* gray-200 */
        }

        /* Make table horizontally scrollable on small screens */
        .table-responsive {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }

        /* Modal Styles */
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1000; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
            /* Removed display: flex from here so it doesn't override display: none */
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .close-button {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
        }

        .close-button:hover,
        .close-button:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        /* Message Box styles */
        .message-box {
            display: none; /* Hidden by default */
            position: fixed;
            z-index: 1001; /* Higher than modal */
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            align-items: center;
            justify-content: center;
        }
        .message-box-content {
            background-color: #fefefe;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 80%;
            max-width: 400px;
            text-align: center;
        }
        .message-box-content h3 {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .message-box-content p {
            font-size: 1rem;
            color: #555;
            margin-bottom: 20px;
        }
        .message-box-content button {
            background-color: #27AE60;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        .message-box-content button:hover {
            background-color: #229954;
        }


        /* Print Styles - These are now primarily for visual reference, as JS will apply similar styles for html2canvas */
        @media print {
            /* Hide the navigation bar */
            nav {
                display: none !important;
            }

            /* Hide the bottom navigation bar */
            #bottomNavBar {
                display: none !important;
            }

            /* Hide the assessment form section */
            #assessmentSection {
                display: none !important;
            }

            /* Hide the Inn Name input field and its label */
            #innNameInput, label[for="innNameInput"] {
                display: none !important;
            }

            /* Hide calculation and print buttons (they are now in the bottom nav, so this is for redundancy) */
            #calculateBtn, #printBtn, #exportBtn, #loadBtn { 
                display: none !important;
            }

            /* Hide modals */
            .modal, .message-box { 
                display: none !important;
            }

            /* Ensure results section is visible and takes full width for printing */
            #resultsSection {
                display: block !important;
                visibility: visible !important;
                position: relative !important;
                left: 0 !important;
                top: 0 !important;
                width: 100% !important;
                max-width: none !important;
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                background-color: transparent !important; /* No background on print */
            }

            /* Adjust main content wrapper for print */
            body > .max-w-6xl.w-full { /* Target the main content div that wraps everything */
                margin: 0 !important;
                padding: 0 !important;
                box-shadow: none !important;
                background-color: transparent !important;
                width: 100% !important;
                max-width: none !important;
            }

            /* Reset body padding set for fixed navs */
            body {
                padding-top: 0 !important;
                padding-bottom: 0 !important;
                background-color: #fff !important; /* White background for print */
            }

            /* Hide the introduction paragraph for printing */
            #introductionText {
                display: none !important;
            }

            /* Force background colors of progress bars to print */
            #overallMaturityBar,
            #categoryTableBody .h-4.rounded-full {
                -webkit-print-color-adjust: exact !important; /* For Chrome/Safari */
                print-color-adjust: exact !important; /* Standard property */
            }

            /* Show print title */
            #printTitle {
                display: block !important;
                text-align: center;
                font-size: 2em; /* Larger font size for title */
                font-weight: bold;
                margin-bottom: 20px; /* Space below title */
                color: #2D3748; /* A darker grey for text */
            }

            /* Adjust overall maturity bar labels for print */
            .max-w-6xl.w-full > .relative.w-full.h-auto.mt-2 > span {
                font-size: 0.6em !important; /* Make font smaller for bar labels */
            }

            /* Adjust table cell padding for print */
            #categoryTableBody th, #categoryTableBody td {
                padding: 0.5rem !important;
                font-size: 0.8em !important;
            }
            #categoryTableBody .relative.w-full.h-auto.mt-2 > span {
                font-size: 0.5em !important; /* Smaller labels for individual category bars */
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center">
    <!-- Navigation Bar (Fixed at top) -->
    <nav class="fixed top-0 left-0 right-0 z-50 bg-green-700 text-white shadow-lg w-full py-2">
        <div class="max-w-6xl mx-auto px-4 flex justify-between items-center w-full">
            <!-- Adjusted title font size and centered -->
            <h1 class="text-lg font-bold text-center flex-grow">民宿永續旅遊成熟度自評工具</h1>
            <div class="flex space-x-4">
                <!-- Global Set Score button - Hidden by default -->
                <button id="globalSetScoreBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition duration-150 ease-in-out text-2xl hidden">
                    &#128274; <!-- Unicode for lock emoji -->
                </button>
                <!-- Help Button - Text changed to "填答說明" -->
                <button id="helpBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition duration-150 ease-in-out">
                    填答說明
                </button>
            </div>
        </div>
    </nav>

    <div class="max-w-6xl w-full bg-white shadow-xl rounded-lg p-8 mt-10 mb-10"> <!-- Adjusted mt-10 for content clearance -->
        <!-- Updated Introduction Text as per user request -->
        <p id="introductionText" class="text-lg text-gray-700 text-center mb-6 font-bold">請您就民宿的實際情況，在每項指標的「行動完整性」與「記錄及文件完整性」中，選擇最適合的描述。</p>

        <!-- New input field for Inn Name - MOVED HERE AND STYLED AS A CARD -->
        <!-- Background changed to bg-green-50 -->
        <div id="innNameCard" class="category-card bg-green-50 p-6 rounded-lg shadow-md mb-16">
            <label for="innNameInput" class="block text-xl font-bold text-gray-800 mb-4 text-center">請輸入民宿名稱：</label>
            <input type="text" id="innNameInput" value="民宿" class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-green-500 text-center text-lg">
        </div>

        <div id="assessmentSection">
            <!-- Category A: 永續管理 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">A、永續管理</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <!-- Column 1: Indicator Name & Description (50% overall width on desktop) -->
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">A1 永續規劃執行</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者將環境、社會、文化、經濟、品質、人權、健康、安全、風險與危機管理等永續要素考慮在內，落實於民宿經營管理中，並有專責人員負責持續監測改善執行。</p>
                        </div>
                        
                        <!-- Column 2: Action (50% overall width on desktop, split with Record) -->
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>

                        <!-- Vertical Separator Line - REMOVED -->

                        <!-- Column 3: Record (50% overall width on desktop, split with Action) -->
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">A2 準確行銷宣傳</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者定期彙整其永續旅遊之政策、行動與績效等，並主動揭露給顧客、供應商及社區居民等利害關係人。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">A3 資訊與解說</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者提供遊客周邊的自然資源、當地文化習俗及遺產之資訊與解說，以及應當遵守的行為規範。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-3" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-3" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">A4 顧客回饋機制</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者能持續彙整分析顧客滿意度，並依顧客回饋意見執行適合的改善計畫。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-4" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-4" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">A5 員工參與</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者能透過教育訓練或其他方式，讓自身及員工了解民宿的永續規劃及行動方案。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-5" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-5" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">A6 潛在風險因應機制</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者應主動辨認營運區域各項天然性災害風險，研擬因應計畫，並持續對民宿建築、設施、設備等進行日常檢修以提供安全環境。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-6" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-6" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">A7 目的地參與</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者應積極參與及支持目的地之永續規劃、管理與推動，並與利害關係人共同合作。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-7" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="A-7" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category B: 永續採購 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">B、永續採購</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">B1 環境友善採購</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者優先採購具有環境友善認證或在地生產的產品與服務。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="B-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="B-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">B2 源頭減量作為</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者推動源頭減量，減少資源消耗和廢棄物產生。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="B-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="B-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">B3 紀錄與監測</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者是否紀錄和監測採購物品的永續性資訊？</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="B-3" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="B-3" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category C: 社區支持 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">C、社區支持</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">C1 支持在地店家</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者提供產品服務、策略合作或採購時，優先支持具有在地特色、品質與環境友善之店家。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="C-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="C-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">C2 支持社區發展</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者支援當地社區發展所需之相關資源，並提供設施與服務讓社區使用。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="C-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="C-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">C3 社區衝擊管理</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者之營運活動，應考慮其對當地社區原有公共服務設施的排擠與負面影響。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="C-3" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="C-3" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category D: 員工支持 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">D、員工支持</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">D1 平等機會待遇</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者在聘用員工時，應給予當地居民平等機會，同時不因其性別、種族、宗教或其他因素，影響其獲得錄用的機會。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="D-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="D-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">D2 員工尊嚴</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者除提供合乎法規的薪資外，能依其工作條件給予合理的報酬；此外，重視員工的權利並提供安全的工作環境，同時對員工個別提供適當的在職培訓。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="D-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="D-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">D3 反騷擾與剝削</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者抵制任何剝削與騷擾行為（尤其對兒童、青少年、婦女及弱勢團體），並能提出相關措施與執行。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="D-3" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="D-3" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category E: 文化保護 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">E、文化保護</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">E1 文化認識</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者應對當地之有形與無形、傳統與當代文化資產或習俗盡可能進行了解。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="E-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="E-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">E2 文化呈現</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者將當地傳統及(或)當代地方文化元素融入營運活動中。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="E-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="E-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">E3 文化參與</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者紀錄對文化保護所做的貢獻(如捐贈、參與保育行動等)，並向顧客推廣文化保存理念及宣導應遵守之當地文化相關規範。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="E-3" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="E-3" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category F: 環境保護 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">F、環境保護</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">F1 有害物質</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者於營運活動中，減少對環境有害物質之使用 (例如農藥、塗料、消毒劑、清潔材料等)。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="F-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="F-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">F2 減少污染</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者於營運活動中所產生之噪音、光、水、空氣等污染，能採取適當措施以減少對環境的影響。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="F-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="F-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category G: 水資源管理 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">G、水資源管理</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">G1 節水設備與措施</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者採用有效的設備與措施減少耗水總量，持續進行紀錄與監測，並對員工和顧客進行節水宣導。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="G-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="G-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">G2 廢污水處理</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者能以有效措施再利用廢污水，並以安全及合乎規範的方式排放廢水。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="G-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="G-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category H: 廢棄物處理 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">H、廢棄物處理</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">H1 廢棄物紀錄與監測</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者對其廢棄物 (含廚餘)進行分類並紀錄。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="H-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="H-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">H2 廢棄物減量機制</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者依據廢棄物之分類統計紀錄，研擬廢棄物的減量措施。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="H-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="H-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category I: 溫室氣體因應 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">I、溫室氣體因應</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">I1 節能設備與措施</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者使用符合節能的設備並研擬相關措施，以減少能源使用量。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="I-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="I-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">I2 交通運輸</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者設法減少各種交通運輸的需求(如推動大眾運輸或共乘)，並鼓勵顧客、員工、供應商等使用乾淨能源或節省能源的運輸工具。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="I-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="I-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">I3 溫室氣體減排</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者研擬減量措施，以逐步達成淨零排放目標，包含溫室氣體及碳足跡盤查。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="I-3" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="I-3" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">I4 紀錄與監測</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者於本準則各項指標均有清楚的紀錄及持續監測之文件。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="I-4" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="I-4" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Category J: 生態保護 -->
            <div class="category-card bg-white p-6 rounded-lg shadow-md mb-16">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">J、生態保護</h2>
                <div class="space-y-6">
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">J1 保護生物多樣性</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者設法以參與或贊助等方式支持生物多樣性保育，並盡可能減少對自然生態系統的干擾，同時採取行動鼓勵顧客支持。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="J-1" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="J-1" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">J2 優先使用本土物種</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者優先使用本地原生物種進行空間與環境綠化。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="J-2" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="J-2" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="indicator-card bg-gray-50 p-4 rounded-lg shadow-sm flex flex-col md:flex-row md:items-stretch justify-between">
                        <div class="w-full md:w-1/2 md:pr-4 flex-shrink-0">
                            <p class="text-lg font-bold text-gray-700 mb-1">J3 推廣自然景觀景點</p>
                            <p class="text-lg font-medium text-gray-700 mb-2 md:mb-0">民宿經營者瞭解鄰近的自然景點，並向顧客宣導應遵守之相關規範。</p>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:px-2 flex-shrink-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="J-3" data-type="action">
                                <span class="font-semibold text-gray-600">行動完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                        <div class="flex flex-col w-full md:w-1/4 md:pl-2 flex-shrink-0 mt-4 md:mt-0">
                            <div class="flex flex-col items-start pb-4" data-indicator="J-3" data-type="record">
                                <span class="font-semibold text-gray-600">記錄及文件完整性:</span>
                                <div class="flex space-x-1">
                                    <button class="score-btn" data-score="0">0</button>
                                    <button class="score-btn" data-score="1">1</button>
                                    <button class="score-btn" data-score="2">2</button>
                                    <button class="score-btn" data-score="3">3</button>
                                    <button class="score-btn" data-score="4">4</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="resultsSection" class="mt-12 p-8 bg-green-50 rounded-lg shadow-lg hidden">
            <!-- Print Title (Hidden by default, shown only on print) -->
            <h1 id="printTitle" class="hidden">民宿永續旅遊成熟度自評工具</h1>

            <!-- New: Title for the assessment tool -->
            <h1 id="assessmentToolTitle" class="text-4xl font-bold text-center text-black mb-2">民宿永續旅遊成熟度自評工具</h1>
            <!-- New: Assessment Date -->
            <p id="assessmentDate" class="text-sm text-center text-black mb-4"></p>

            <!-- Displayed Inn Name -->
            <h2 id="displayedInnName" class="text-4xl font-bold text-center text-green-800 mb-4"></h2>
            
            <h3 class="text-2xl font-bold text-center text-gray-800 mb-6">總體永續旅遊成熟度(自評)</h3>

            <!-- Overall Maturity Section with Card Background (Now separate) -->
            <div id="overallMaturityCard" class="category-card bg-white p-6 rounded-lg shadow-md mb-6">
                <!-- Overall Maturity Progress Bar (Full width, below the title) -->
                <div class="relative w-full bg-gray-100 rounded-full h-4 mb-2">
                    <div id="overallMaturityBar" class="h-4 rounded-full" style="width: 0%;"></div>
                    <!-- Tick marks for 1, 2, 3 -->
                    <div class="absolute h-6 w-0.5 bg-gray-400" style="left: 25%; top: -2px; transform: translateX(-50%);"></div>
                    <div class="absolute h-6 w-0.5 bg-gray-400" style="left: 50%; top: -2px; transform: translateX(-50%);"></div>
                    <div class="absolute h-6 w-0.5 bg-gray-400" style="left: 75%; top: -2px; transform: translateX(-50%);"></div>
                </div>
                <div class="relative w-full h-auto mt-2 mb-6"> <!-- Adjusted mb for spacing -->
                    <!-- Removed "0分", "1分", "2分", "3分", "4分" -->
                    <span class="absolute text-xs text-gray-500" style="left: 12.5%; transform: translateX(-50%); white-space: nowrap;">基礎</span>
                    <span class="absolute text-xs text-gray-500" style="left: 37.5%; transform: translateX(-50%); white-space: nowrap;">發展</span>
                    <span class="absolute text-xs text-gray-500" style="left: 62.5%; transform: translateX(-50%); white-space: nowrap;">整合</span>
                    <span class="absolute text-xs text-gray-500" style="left: 87.5%; transform: translateX(-50%); white-space: nowrap;">模範</span>
                </div>

                <div class="text-center mb-6">
                    <!-- Overall Maturity Level and Score with Toggle -->
                    <div class="text-4xl font-bold text-green-700 flex items-center justify-center cursor-pointer" id="overallMaturityToggle">
                        <span id="overallMaturityLevel"></span>
                        <span id="overallMaturityScore" class="text-2xl ml-2"></span> <!-- Smaller font for score, added ml-2 for spacing -->
                        <span id="toggleArrow" class="ml-2 text-2xl text-gray-500 transition-transform duration-300 transform">&#9660;</span> <!-- Moved arrow, changed to gray -->
                    </div>
                    <!-- Overall Maturity Description, initially hidden -->
                    <div id="overallMaturityDescription" class="mt-2 text-center text-gray-700 hidden"></div>
                </div>
            </div>
            
            <!-- Radar Chart Section with Card Background (Now separate) -->
            <div id="radarChartCard" class="category-card bg-white p-6 rounded-lg shadow-md mb-6 flex items-center justify-center">
                <canvas id="maturityRadarChart" class="w-full"></canvas>
            </div>

            <div class="mb-10 mt-10">
                <h3 class="text-2xl font-bold text-center text-gray-800 mb-6">各面向成熟度(自評)</h3>
                <!-- All category cards are now within this single card -->
                <div id="allCategoryResultsCard" class="category-card bg-white p-6 rounded-lg shadow-md">
                    <div id="categoryCardsWrapper" class="flex flex-col items-center gap-1"> <!-- Reduced gap to gap-1 -->
                        <!-- Category cards will be inserted here by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- New: Copyright and Attribution Text -->
            <div class="text-center text-gray-700 mt-8 text-base"> <!-- Added mt-8 for spacing, text-base for font size -->
                <p>評估由NCNU永續旅遊研發中心籌備處提供</p>
                <p>Copyright © 2025 Lai Ho Tak.</p>
                <p>All rights reserved.</p>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation Bar (Fixed at bottom) -->
    <nav id="bottomNavBar" class="fixed bottom-0 left-0 right-0 z-50 bg-green-700 text-white shadow-lg w-full py-4">
        <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center w-full">
            <!-- Left Column: Progress Bar & Quick Guide Section -->
            <div class="flex flex-col items-center w-full md:w-1/2 md:pr-4">
                <div class="flex justify-between items-center w-full mb-1">
                    <span class="text-white text-sm font-medium" id="progressText">已完成 0/32 個指標</span>
                </div>
                <div class="w-full bg-gray-400 rounded-full h-2">
                    <div id="progressBar" class="bg-green-500 h-2 rounded-full progress-bar" style="width: 0%;"></div>
                </div>
                <!-- Removed Quick Guide Section as per user request -->
            </div>
            
            <!-- Right Column: Buttons -->
            <div class="flex justify-end items-center w-full md:w-1/2 md:pl-4 mt-4 md:mt-0 space-x-4">
                <button id="calculateBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                    計算結果
                </button>
                <button id="downloadResultBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition duration-150 ease-in-out disabled:opacity-50 disabled:cursor-not-allowed">
                    下載結果
                </button>
                <!-- Moved Reset button here -->
                <button id="resetBtn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-500 transition duration-150 ease-in-out">
                    重設
                </button>
            </div>
        </div>
    </nav>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeHelpModalBtn">&times;</span>
            <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">填答說明</h2>
            <div class="flex flex-col items-center space-y-6">
                <!-- Image 1: Action explanation -->
                <img src="https://github.com/RacsoLai/RacsoLai.github.io/blob/main/action.png?raw=true" alt="行動完整性說明" class="max-w-full h-auto rounded-lg shadow-md">
                <!-- Image 2: Record explanation -->
                <img src="https://github.com/RacsoLai/RacsoLai.github.io/blob/main/record.png?raw=true" alt="記錄及文件完整性說明" class="max-w-full h-auto rounded-lg shadow-md">
            </div>
        </div>
    </div>

    <!-- Global Set Score Modal (New) -->
    <div id="scoreSetModal" class="modal">
        <div class="modal-content">
            <span class="close-button" id="closeScoreSetModalBtn">&times;</span>
            <h2 class="text-2xl font-bold text-gray-800 mb-6 text-center">全部設定為...</h2>
            <div class="flex flex-wrap justify-center gap-4">
                <button class="global-score-set-btn px-6 py-3 bg-green-600 text-white rounded-lg text-lg hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out" data-set-score="1">
                    1
                </button>
                <button class="global-score-set-btn px-6 py-3 bg-green-600 text-white rounded-lg text-lg hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out" data-set-score="2">
                    2
                </button>
                <button class="global-score-set-btn px-6 py-3 bg-green-600 text-white rounded-lg text-lg hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out" data-set-score="3">
                    3
                </button>
                <button class="global-score-set-btn px-6 py-3 bg-green-600 text-white rounded-lg text-lg hover:bg-green-500 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-opacity-50 transition duration-150 ease-in-out" data-set-score="4">
                    4
                </button>
            </div>
        </div>
    </div>

    <!-- Custom Message Box -->
    <div id="messageBox" class="message-box">
        <div class="message-box-content">
            <h3 id="messageBoxTitle"></h3>
            <p id="messageBoxBody"></p>
            <button id="closeMessageBoxBtn">確定</button>
        </div>
    </div>


    <script>
        console.log("Script parsing started."); // Added for debugging

        // Define categories and their corresponding indicator prefixes and display names
        const categories = {
            'A': { name: '永續管理', indicators: 7 },
            'B': { name: '永續採購', indicators: 3 },
            'C': { name: '社區支持', indicators: 3 },
            'D': { name: '員工支持', indicators: 3 },
            'E': { name: '文化保護', indicators: 3 },
            'F': { name: '環境保護', indicators: 2 },
            'G': { name: '水資源管理', indicators: 2 },
            'H': { name: '廢棄物處理', indicators: 2 },
            'I': { name: '溫室氣體因應', indicators: 4 },
            'J': { name: '生態保護', indicators: 3 }
        };
        const categoryKeys = Object.keys(categories);

        // Total number of indicators (each has two sub-scores, but we count the indicator as complete if both are filled)
        // This needs to be declared globally so updateProgress can access it.
        const totalIndicators = Object.values(categories).reduce((sum, cat) => sum + cat.indicators, 0);

        // Declare a variable for the Chart instance outside the DOMContentLoaded
        // so it can be destroyed and recreated.
        let maturityRadarChart; 
        // Declare a variable for the QRCode instance
        let qrcodeInstance;

        // Define colors for each maturity level (0-4)
        const maturityColors = {
            '基礎': '#F2994A', // Orange from 等級1
            '發展': '#F2C94C', // Yellow from 等級2
            '整合': '#A3CC5F', // Light Green from 等級3
            '模範': '#27AE60'  // Green from 等級4
        };

        // Mapping for score button selected colors
        const scoreButtonSelectedColors = {
            0: '#EF4444', // Red-500 for 0
            1: '#F2994A', // Orange for 基礎
            2: '#F2C94C', // Yellow for 發展
            3: '#A3CC5F', // Light Green for 整合
            4: '#27AE60'  // Green for 模範
        };

        // Score to character mapping for export
        const scoreToCharMap = {
            0: 'R',
            1: 'M',
            2: 'N',
            3: 'O',
            4: 'P'
        };

        // Character to score mapping for import (reverse of scoreToCharMap)
        const charToScoreMap = {
            'R': 0,
            'M': 1,
            'N': 2,
            'O': 3,
            'P': 4
        };
        // Get all valid characters for validation
        const validChars = Object.keys(charToScoreMap); // Corrected: Changed charToCharMap to charToScoreMap

        // Function to determine maturity level and description based on score
        function getMaturityInfo(score) {
            let level = '';
            let description = '';
            let color = '';

            if (score >= 0 && score < 1) {
                level = '基礎';
                description = `民宿處於開始參與永續旅遊的階段。<br>
民宿主要著重於基本意識，可能僅依循最基本規範。<br>
民宿相關永續方案與措施與多為臨時性，尚未系統性地整合到日常營運與管理中。<br>
民宿開始對部分永續旅遊相關表現進行紀錄與監測。`;
                color = maturityColors['基礎'];
            } else if (score >= 1 && score < 2) {
                level = '發展';
                description = `民宿已持續參與永續旅遊，其宿表現已超越基本規範，並正採取更具目標性的行動。<br>
民宿已實施多項永續旅遊相關實踐並取得顯著進展。<br>
永續旅遊可能尚未全面融入所有營運環節。<br>
民宿已經持續對永續旅遊相關表現進行紀錄與監測。`;
                color = maturityColors['發展'];
            } else if (score >= 2 && score < 3) {
                level = '整合';
                description = `永續旅遊已穩定且持續地融入民宿營運的各個關鍵面向。<br>
民宿採用更系統化的管理方法，並建立了相關政策和程序。<br>
民宿已經持續對永續旅遊相關表現進行紀錄與監測，並將利害關係人為意見整合用以進行持續改善。<br>
以持續改進為目標，但可能在創新或更廣泛的影響方面仍有提升空間。`;
                color = maturityColors['整合'];
            } else if (score >= 3 && score <= 4) {
                level = '模範';
                description = `民宿展現出全面且卓越的永續旅遊表現。<br>
永續承諾已深入其經營理念、日常營運和體驗中。<br>
持續追求超越預期，並為全面性永續旅遊做出積極貢獻，成為其他民宿的標竿。`;
                color = maturityColors['模範'];
            } else {
                level = 'N/A';
                description = '得分超出有效範圍。';
                color = '#6B7280'; // Gray for N/A
            }
            return { level, description, color };
        }

        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOMContentLoaded fired."); // Added for debugging

            const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw7cnV1zbAAixSJeHu3TpzFtLP3cfqd-u_kFKx9IOO2ce-ApSr4Wp827WZHIBfhcKK-/exec'; // Your Google Apps Script Web App URL

            const scoreButtons = document.querySelectorAll('.score-btn');
            const progressText = document.getElementById('progressText');
            const progressBar = document.getElementById('progressBar');
            // Buttons moved to bottom nav, but their IDs remain the same for JS
            const calculateBtn = document.getElementById('calculateBtn'); 
            const downloadResultBtn = document.getElementById('downloadResultBtn'); // Renamed from printBtn

            const resetBtn = document.getElementById('resetBtn');
            const helpBtn = document.getElementById('helpBtn'); // Re-added
            const globalSetScoreBtn = document.getElementById('globalSetScoreBtn');
            const resultsSection = document.getElementById('resultsSection');
            const overallMaturityLevel = document.getElementById('overallMaturityLevel');
            const overallMaturityScore = document.getElementById('overallMaturityScore'); 
            const overallMaturityDescription = document.getElementById('overallMaturityDescription');
            const overallMaturityBar = document.getElementById('overallMaturityBar');
            const overallMaturityBarContainer = overallMaturityBar.closest('.relative.w-full.bg-gray-100.rounded-full.h-4.mb-2'); // Get the parent container
            const overallMaturityBarLabelsContainer = overallMaturityBar.closest('.max-w-6xl.w-full').querySelector('.relative.w-full.h-auto.mt-2.mb-6'); // Get the labels container

            const helpModal = document.getElementById('helpModal');
            const closeHelpModalBtn = document.getElementById('closeHelpModalBtn');

            const scoreSetModal = document.getElementById('scoreSetModal');
            const closeScoreSetModalBtn = document.getElementById('closeScoreSetModalBtn');

            const messageBox = document.getElementById('messageBox'); 
            const messageBoxTitle = document.getElementById('messageBoxTitle');
            const messageBoxBody = document.getElementById('messageBoxBody');
            const closeMessageBoxBtn = document.getElementById('closeMessageBoxBtn');


            const globalScoreSetBtns = scoreSetModal.querySelectorAll('.global-score-set-btn');

            // const categoryTableBody = document.getElementById('categoryTableBody'); // Removed
            const categoryCardsWrapper = document.getElementById('categoryCardsWrapper'); // New element
            const maturityRadarChartCanvas = document.getElementById('maturityRadarChart');

            // New elements
            const innNameInput = document.getElementById('innNameInput');
            const displayedInnName = document.getElementById('displayedInnName');
            const assessmentSection = document.getElementById('assessmentSection'); // Get assessment section
            const innNameCard = document.getElementById('innNameCard'); // Get the inn name card
            const introductionText = document.getElementById('introductionText'); // Get the introduction text

            // New: Overall Maturity Toggle elements
            const overallMaturityToggle = document.getElementById('overallMaturityToggle');
            const toggleArrow = document.getElementById('toggleArrow');

            // New: References to the new cards in results section
            const overallMaturityResultsCard = document.getElementById('overallMaturityCard');
            const radarChartResultsCard = document.getElementById('radarChartCard');
            const allCategoryResultsCard = document.getElementById('allCategoryResultsCard'); // New: Reference to the single card for all categories

            // New: Elements for the new lines above inn name
            const assessmentToolTitle = document.getElementById('assessmentToolTitle');
            const assessmentDate = document.getElementById('assessmentDate');

            // Check for admin mode and toggle globalSetScoreBtn visibility
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === '1') {
                globalSetScoreBtn.classList.remove('hidden');
            } else {
                globalSetScoreBtn.classList.add('hidden');
            }


            // Store selected scores for each indicator: 'A-1': { action: score, record: score }, ... }
            const selectedScores = {}; // This object will store the scores for the two sub-scores of each indicator

            // Initialize selectedScores with undefined for all expected indicators and score types
            function initializeScores() {
                for (const categoryKey in categories) {
                    for (let i = 1; i <= categories[categoryKey].indicators; i++) {
                        const indicatorId = `${categoryKey}-${i}`;
                        selectedScores[indicatorId] = {
                            action: undefined,
                            record: undefined
                        };
                    }
                }
            }
            initializeScores();
            // Call updateProgress initially to set the correct button state on page load
            updateProgress(); 

            // Function to show custom message box
            function showMessageBox(title, message) {
                messageBoxTitle.textContent = title;
                messageBoxBody.textContent = message;
                messageBox.style.display = 'flex';
            }

            // Function to hide custom message box
            closeMessageBoxBtn.addEventListener('click', () => {
                messageBox.style.display = 'none';
            });


            // Update progress bar and text
            function updateProgress() {
                let completedCount = 0;
                for (const categoryKey in categories) {
                    for (let i = 1; i <= categories[categoryKey].indicators; i++) {
                        const indicatorId = `${categoryKey}-${i}`;
                        // An indicator is completed if both sub-scores are defined
                        if (selectedScores[indicatorId] && 
                            selectedScores[indicatorId].action !== undefined && 
                            selectedScores[indicatorId].record !== undefined) {
                            completedCount++;
                        }
                    }
                }
                // Log progress for debugging
                console.log(`updateProgress: completedCount = ${completedCount}, totalIndicators = ${totalIndicators}`); 
                progressText.textContent = `已完成 ${completedCount}/${totalIndicators} 個指標`;
                const progressWidth = (completedCount / totalIndicators) * 100;
                progressBar.style.width = `${progressWidth}%`;

                // CalculateBtn should be enabled if all indicators are answered
                const isAllIndicatorsCompleted = (completedCount === totalIndicators);

                if (isAllIndicatorsCompleted) {
                    calculateBtn.disabled = false;
                    calculateBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    calculateBtn.disabled = true;
                    calculateBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
                
                // Download and Export buttons should only be enabled when results section is visible (i.e., after calculation)
                const isResultsVisible = !resultsSection.classList.contains('hidden');

                if (isResultsVisible) {
                    downloadResultBtn.disabled = false; // Renamed from printBtn
                    downloadResultBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    downloadResultBtn.disabled = true; // Renamed from printBtn
                    downloadResultBtn.classList.add('opacity-50', 'cursor-not-allowed');
                }
            }

            // Function to visually update score buttons based on selectedScores
            function updateScoreButtonsUI() {
                console.log("Starting updateScoreButtonsUI.");
                document.querySelectorAll('.indicator-card').forEach(indicatorCard => {
                    const indicatorId = indicatorCard.querySelector('[data-indicator]').dataset.indicator;

                    // Update 'action' buttons
                    const actionDiv = indicatorCard.querySelector('[data-type="action"]');
                    if (actionDiv) {
                        actionDiv.querySelectorAll('.score-btn').forEach(button => {
                            const buttonScore = parseInt(button.dataset.score);
                            if (selectedScores[indicatorId] && selectedScores[indicatorId].action !== undefined && buttonScore === selectedScores[indicatorId].action) {
                                button.classList.add('selected');
                                button.style.backgroundColor = scoreButtonSelectedColors[buttonScore];
                                button.style.borderColor = scoreButtonSelectedColors[buttonScore];
                            } else {
                                button.classList.remove('selected');
                                button.style.backgroundColor = '#f3f4f6'; // gray-100
                                button.style.borderColor = '#d1d5db'; // gray-300
                            }
                        });
                    }

                    // Update 'record' buttons
                    const recordDiv = indicatorCard.querySelector('[data-type="record"]'); // Corrected: Added missing ']'
                    if (recordDiv) {
                        recordDiv.querySelectorAll('.score-btn').forEach(button => {
                            const buttonScore = parseInt(button.dataset.score);
                            if (selectedScores[indicatorId] && selectedScores[indicatorId].record !== undefined && buttonScore === selectedScores[indicatorId].record) {
                                button.classList.add('selected');
                                button.style.backgroundColor = scoreButtonSelectedColors[buttonScore];
                                button.style.borderColor = scoreButtonSelectedColors[buttonScore];
                            } else {
                                button.classList.remove('selected');
                                button.style.backgroundColor = '#f3f4f6'; // gray-100
                                button.style.borderColor = '#d1d5db'; // gray-300
                            }
                        });
                    }
                });
                console.log("Finished updateScoreButtonsUI. Updating progress and hiding results section.");
                updateProgress(); // Update progress after UI changes
                // resultsSection.classList.add('hidden'); // This line is now handled by calculateBtn click
            }


            // Handle score button click for individual indicators
            scoreButtons.forEach(button => {
                button.addEventListener('click', (event) => {
                    const parentDiv = event.target.closest('[data-indicator][data-type]');
                    const indicatorId = parentDiv.dataset.indicator;
                    const scoreType = parentDiv.dataset.type; // "action" or "record"
                    const score = parseInt(event.target.dataset.score);

                    // Initialize the indicator object if it doesn't exist
                    if (!selectedScores[indicatorId]) {
                        selectedScores[indicatorId] = {};
                    }
                    // Set the specific score type
                    selectedScores[indicatorId][scoreType] = score;

                    // Remove 'selected' class from all buttons in this specific sub-group
                    parentDiv.querySelectorAll('.score-btn').forEach(btn => {
                        btn.classList.remove('selected');
                        // Reset background color for unselected buttons
                        btn.style.backgroundColor = '#f3f4f6'; // gray-100
                        btn.style.borderColor = '#d1d5db'; // gray-300
                    });

                    // Add 'selected' class and set background color to the clicked button
                    event.target.classList.add('selected');
                    event.target.style.backgroundColor = scoreButtonSelectedColors[score];
                    event.target.style.borderColor = scoreButtonSelectedColors[score];

                    // Hide results when scores are changed
                    resultsSection.classList.add('hidden');
                    updateProgress();
                });
            });

            // Handle global score setting buttons (now inside the modal)
            globalScoreSetBtns.forEach(button => {
                button.addEventListener('click', (event) => {
                    const scoreToSet = parseInt(event.target.dataset.setScore);
                    
                    // Close the modal after setting scores
                    scoreSetModal.style.display = 'none';

                    // Update selectedScores
                    for (const categoryKey in categories) {
                        for (let i = 1; i <= categories[categoryKey].indicators; i++) {
                            const indicatorId = `${categoryKey}-${i}`;
                            selectedScores[indicatorId] = { 
                                action: scoreToSet, 
                                record: scoreToSet 
                            };
                        }
                    }
                    // Call updateScoreButtonsUI to refresh the display for all buttons
                    updateScoreButtonsUI(); 

                    // Hide results when scores are changed
                    resultsSection.classList.add('hidden');
                    // Update progress bar and button state
                    updateProgress();
                });
            });

            // Function to render the radar chart
            function renderRadarChart(categoryAverages) {
                if (maturityRadarChart) {
                    maturityRadarChart.destroy(); // Destroy previous chart instance if exists
                }

                const labels = categoryKeys; // A, B, C, ... J
                const data = labels.map(key => categoryAverages[key] !== undefined ? categoryAverages[key] : 0);

                const ctx = maturityRadarChartCanvas.getContext('2d');
                maturityRadarChart = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: '平均成熟度分數',
                            data: data,
                            backgroundColor: 'rgba(39, 174, 96, 0.4)', // Semi-transparent green
                            borderColor: 'rgba(39, 174, 96, 1)', // Solid green
                            pointBackgroundColor: 'rgba(39, 174, 96, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(39, 174, 96, 1)',
                            borderWidth: 2,
                            fill: true, // Fill the area under the radar data
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true, // Maintain aspect ratio within the smaller container
                        scales: {
                            r: {
                                angleLines: {
                                    color: 'rgba(209, 213, 219, 0.8)' // Light grey for angle lines
                                },
                                grid: {
                                    color: 'rgba(209, 213, 219, 0.8)' // Light grey for grid lines
                                },
                                pointLabels: {
                                    font: {
                                        size: 14,
                                        family: 'Noto Sans TC' // Ensure Noto Sans TC is used
                                    },
                                    color: '#4A5568' // Darker grey for labels
                                },
                                // Set min and max for the radar chart
                                min: 0,
                                max: 4,
                                ticks: {
                                    display: false, // Hide the numbers on the scale
                                    stepSize: 1, // Ensure steps at 0, 1, 2, 3, 4
                                },
                                // Configure scale properties to show lines but hide labels
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: false // Hide dataset label
                            },
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.r !== null) {
                                            label += context.parsed.r.toFixed(2); // Removed '分'
                                        }
                                        return label;
                                    }
                                }
                            }
                        },
                        elements: {
                            line: {
                                tension: 0.1 // Slight curve to the line
                            }
                        }
                    }
                });
            }

            /**
             * Sends assessment data to Google Sheet via Apps Script.
             * @param {string} timestamp - The current assessment timestamp.
             * @param {string} innName - The name of the inn.
             * @param {string} encodedData - The encoded assessment data string.
             */
            async function sendDataToGoogleSheet(timestamp, innName, encodedData) {
                try {
                    // Updated message 1: "分析生成中"
                    showMessageBox('分析生成中', '正在將您的評估進行分析，請稍候...');

                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        mode: 'no-cors', // Use 'no-cors' mode for Google Apps Script as it often requires it
                        // Note: In 'no-cors' mode, you cannot read the response status or body,
                        // so success is assumed if the fetch operation itself doesn't throw an error.
                        // For robust error handling and response validation, a CORS-enabled endpoint
                        // or a proxy would be necessary.
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            timestamp: timestamp,
                            innName: innName,
                            encodedData: encodedData
                        })
                    });

                    // Updated message 2, 3, 4, 5
                    // For 'no-cors' mode, response.ok will always be false and status will be 0.
                    // We rely on the Apps Script to confirm success (which it cannot directly in no-cors).
                    // In a real production environment, you would set up CORS properly on the Apps Script
                    // or a proxy server to handle the request.
                    // For this demonstration, we'll assume success if the fetch operation itself doesn't throw.

                    // Since we're using no-cors, we'll assume success if no error is thrown
                    // and provide a generic success message. For robust error handling,
                    // CORS setup would be necessary.
                    showMessageBox('分析生成完成', '分析完成！'); 

                } catch (error) {
                    console.error('Error sending data to Google Sheet:', error);
                    showMessageBox('分析生成完成', '分析完成！'); 
                }
            }


            // Calculate Sustainable Maturity
            calculateBtn.addEventListener('click', async () => { 
                // Get the inn name and display it
                const innName = innNameInput.value.trim();
                displayedInnName.textContent = innName || '民宿'; // Default to "民宿" if empty

                // Get current date for assessmentDate
                const today = new Date();
                const year = today.getFullYear();
                const month = (today.getMonth() + 1).toString().padStart(2, '0');
                const day = today.getDate().toString().padStart(2, '0');
                assessmentDate.textContent = `自評日期：${year}/${month}/${day}`;

                const categoryFinalScores = {}; // To store the MIN score for each indicator
                for (const key in categories) {
                    categoryFinalScores[key] = [];
                }

                // Calculate the final score for each indicator (min of action and record)
                for (const categoryKey in categories) {
                    for (let i = 1; i <= categories[categoryKey].indicators; i++) {
                        const indicatorId = `${categoryKey}-${i}`;
                        const scores = selectedScores[indicatorId]; // Get the object for this indicator

                        // Ensure both sub-scores are present before calculating min
                        if (scores.action !== undefined && scores.record !== undefined) {
                            
                            const finalIndicatorScore = Math.min(scores.action, scores.record);
                            categoryFinalScores[categoryKey].push(finalIndicatorScore);
                        } else {
                            // If any sub-score is missing for an indicator, treat its final score as 0 for calculation
                            // This scenario should be rare if calculation button is disabled when not all indicators are completed.
                            categoryFinalScores[categoryKey].push(0); // Pushing 0 for incomplete indicators
                        }
                    }
                }


                const categoryAverages = {};
                const allEvaluatedCategoryAvgs = [];

                // Calculate average for each category and collect for overall average
                for (const key of categoryKeys) {
                    const avg = categoryFinalScores[key].reduce((sum, s) => sum + s, 0) / categoryFinalScores[key].length;
                    categoryAverages[key] = avg;
                    allEvaluatedCategoryAvgs.push(avg);
                }

                // Calculate overall average
                const overallAvg = allEvaluatedCategoryAvgs.length > 0 ?
                    allEvaluatedCategoryAvgs.reduce((sum, avg) => sum + avg, 0) / allEvaluatedCategoryAvgs.length : 0;

                // Determine maturity levels
                const overallInfo = getMaturityInfo(overallAvg);

                // Update Overall Maturity Display
                overallMaturityLevel.textContent = overallInfo.level;
                overallMaturityScore.textContent = `(${overallAvg.toFixed(2)})`; // Display overall score with parentheses and smaller font
                overallMaturityDescription.innerHTML = overallInfo.description; // Use innerHTML to respect newlines
                overallMaturityLevel.style.color = overallInfo.color; // Set color for overall level text
                overallMaturityBar.style.backgroundColor = overallInfo.color; // Set color for overall progress bar
                
                // Scale overall maturity bar (0% for 0, 25% for 1, 50% for 2, 75% for 3, 100% for 4)
                const overallBarWidth = (overallAvg / 4) * 100;
                overallMaturityBar.style.width = `${Math.max(0, overallBarWidth)}%`;


                // Update Category Cards (New Layout)
                categoryCardsWrapper.innerHTML = ''; // Clear existing cards
                
                for (const key of categoryKeys) {
                    const avg = categoryAverages[key];
                    const info = getMaturityInfo(avg);

                    const categoryCardDiv = document.createElement('div');
                    // Changed to w-full for single column layout within the allCategoryResultsCard
                    categoryCardDiv.classList.add(
                        'w-full', // Full width for single column within its parent card
                        'p-1', // Reduced padding to p-1
                        'bg-gray-50', 'rounded-lg', 'shadow-sm', 'flex', 'items-center', 'mb-0.5' // Reduced margin-bottom to mb-0.5
                    );
                    categoryCardDiv.style.minWidth = '150px'; // Ensure minimum width for readability

                    // Use flexbox to control widths for name, level, and progress bar
                    const contentWrapper = document.createElement('div');
                    contentWrapper.classList.add('flex', 'w-full', 'items-center', 'justify-start'); // Changed to justify-start for left alignment

                    // Left side: Category Name (70%)
                    const nameDiv = document.createElement('div');
                    nameDiv.classList.add('w-[70%]', 'text-left'); // 70% width, left-aligned text
                    const nameH4 = document.createElement('h4');
                    nameH4.classList.add('text-base', 'font-bold', 'text-gray-800'); // Adjusted font size to base
                    nameH4.textContent = `${key}. ${categories[key].name}`;
                    nameDiv.appendChild(nameH4);
                    contentWrapper.appendChild(nameDiv);

                    // Right side: Maturity Level and Progress Bar (30%)
                    const levelAndProgressBarWrapper = document.createElement('div');
                    levelAndProgressBarWrapper.classList.add('w-[30%]', 'flex', 'items-center', 'justify-start', 'space-x-2'); // 30% width, flex, left-aligned, space-x-2

                    const levelSpan = document.createElement('span');
                    levelSpan.classList.add('text-base', 'font-bold', 'flex-shrink-0'); // Adjusted font size, prevent shrinking
                    levelSpan.style.color = info.color;
                    levelSpan.textContent = `${info.level}`;
                    levelAndProgressBarWrapper.appendChild(levelSpan);

                    const barContainer = document.createElement('div');
                    barContainer.classList.add('relative', 'bg-gray-100', 'rounded-full', 'h-3', 'flex-grow'); // flex-grow to take remaining space
                    
                    const bar = document.createElement('div');
                    bar.classList.add('h-3', 'rounded-full'); // Reduced height
                    bar.style.backgroundColor = info.color;
                    bar.style.width = `${(avg / 4) * 100}%`;
                    barContainer.appendChild(bar);

                    // Add tick marks for 1, 2, 3 points within the bar container
                    const ticks = [25, 50, 75]; // Percentages for 1, 2, 3 scores relative to the *full* 100%
                    ticks.forEach(tickPos => {
                        const tick = document.createElement('div');
                        tick.classList.add('absolute', 'h-4', 'w-0.5', 'bg-gray-400'); // Reduced height
                        tick.style.left = `${(tickPos / 100) * 100}%`; 
                        tick.style.top = `-1px`; // Adjusted top for smaller bar
                        tick.style.transform = `translateX(-50%)`;
                        barContainer.appendChild(tick);
                    });
                    levelAndProgressBarWrapper.appendChild(barContainer);
                    contentWrapper.appendChild(levelAndProgressBarWrapper);

                    categoryCardDiv.appendChild(contentWrapper);
                    categoryCardsWrapper.appendChild(categoryCardDiv);
                }

                // Render the radar chart
                renderRadarChart(categoryAverages);

                resultsSection.classList.remove('hidden');
                assessmentSection.classList.add('hidden'); // Hide assessment section
                innNameCard.classList.add('hidden'); // Hide inn name input card
                introductionText.classList.add('hidden'); // Hide introduction text
                // Scroll to the results section after calculation
                resultsSection.scrollIntoView({ behavior: 'smooth' });
                updateProgress(); // Re-run to enable download and export buttons

                // --- NEW: Send data to Google Sheet ---
                const currentTimestamp = new Date().toLocaleString('zh-TW', {
                    year: 'numeric', month: '2-digit', day: '2-digit',
                    hour: '2-digit', minute: '2-digit', second: '2-digit',
                    hour12: false
                });
                const currentInnName = innNameInput.value.trim();
                
                // Construct the encodedData string as "actionRecordActionRecord..."
                let encodedDataString = '';
                for (const categoryKey of categoryKeys) {
                    for (let i = 1; i <= categories[categoryKey].indicators; i++) {
                        const indicatorId = `${categoryKey}-${i}`;
                        const scores = selectedScores[indicatorId];
                        // Assuming scores.action and scores.record are always numbers (0-4)
                        // because calculateBtn is disabled until all are filled.
                        encodedDataString += `${scores.action}${scores.record}`;
                    }
                }
                const currentEncodedData = encodedDataString;

                await sendDataToGoogleSheet(currentTimestamp, currentInnName, currentEncodedData);
            });

            // Reset Assessment (this button performs a full reset, including global buttons)
            resetBtn.addEventListener('click', () => {
                // Clear selected scores
                initializeScores();

                // Remove 'selected' class from all buttons and reset their colors
                updateScoreButtonsUI(); // Call this to visually reset all buttons

                // Reset inn name input and display
                innNameInput.value = '民宿';
                displayedInnName.textContent = '';
                assessmentToolTitle.textContent = ''; // Clear the new title
                assessmentDate.textContent = ''; // Clear the new date
                innNameCard.classList.remove('hidden'); // Show inn name input card
                introductionText.classList.remove('hidden'); // Show introduction text

                // Reset progress
                updateProgress(); // This will disable calculateBtn and reset progress bar/text

                // Hide results section
                resultsSection.classList.add('hidden');
                assessmentSection.classList.remove('hidden'); // Show assessment section

                // Clear overall maturity display
                overallMaturityLevel.textContent = '';
                overallMaturityScore.textContent = ''; // Clear overall score
                overallMaturityDescription.textContent = '';
                overallMaturityBar.style.width = '0%';
                overallMaturityBar.style.backgroundColor = ''; // Clear custom color

                // Hide and reset description toggle
                overallMaturityDescription.classList.add('hidden');
                toggleArrow.innerHTML = '&#9660;'; // Reset to down arrow
                
                // Clear category charts and levels (now in table)
                categoryCardsWrapper.innerHTML = ''; // Clear category cards

                // Destroy radar chart if it exists
                if (maturityRadarChart) {
                    maturityRadarChart.destroy();
                    maturityRadarChart = null; // Clear the reference
                }
                // Clear QR code if it exists
                if (qrcodeInstance) {
                    qrcodeInstance.clear();
                    qrcodeInstance = null;
                }
            });

            // Help button and Modal
            helpBtn.addEventListener('click', () => { 
                helpModal.style.display = 'flex'; // Show the modal
            });

            closeHelpModalBtn.addEventListener('click', () => {
                helpModal.style.display = 'none'; // Hide the modal
            });

            // New Global Set Score button click
            globalSetScoreBtn.addEventListener('click', () => {
                scoreSetModal.style.display = 'flex'; // Show the new score set modal
            });

            closeScoreSetModalBtn.addEventListener('click', () => {
                scoreSetModal.style.display = 'none'; // Hide the new score set modal
            });

            // New: Toggle overall maturity description
            overallMaturityToggle.addEventListener('click', () => {
                overallMaturityDescription.classList.toggle('hidden');
                if (overallMaturityDescription.classList.contains('hidden')) {
                    toggleArrow.innerHTML = '&#9660;'; // Down arrow
                } else {
                    toggleArrow.innerHTML = '&#9650;'; // Up arrow
                }
            });

            // Download assessment results as an image
            downloadResultBtn.addEventListener('click', async () => { // Renamed from printBtn
                // Show loading message
                showMessageBox('生成圖片', '正在準備圖片，請稍候...');

                // Elements to temporarily hide for print capture
                const elementsToHideForCapture = [
                    document.querySelector('nav'), // Top nav
                    document.getElementById('bottomNavBar'),
                    document.getElementById('assessmentSection'),
                    document.getElementById('innNameInput'),
                    document.querySelector('label[for="innNameInput"]'),
                    document.getElementById('introductionText')
                ];

                // Store original display styles
                const originalDisplayStyles = new Map();
                elementsToHideForCapture.forEach(el => {
                    if (el) {
                        originalDisplayStyles.set(el, el.style.display);
                        el.style.display = 'none';
                    }
                });

                // Store original styles for resultsSection and its parent
                const originalResultsSectionStyles = {
                    display: resultsSection.style.display,
                    visibility: resultsSection.style.visibility,
                    position: resultsSection.style.position,
                    left: resultsSection.style.left,
                    top: resultsSection.style.top,
                    width: resultsSection.style.width,
                    maxWidth: resultsSection.style.maxWidth,
                    margin: resultsSection.style.margin,
                    padding: resultsSection.style.padding,
                    boxShadow: resultsSection.style.boxShadow,
                    backgroundColor: resultsSection.style.backgroundColor
                };

                const mainContentWrapper = document.querySelector('body > .max-w-6xl.w-full');
                const originalMainContentWrapperStyles = {};
                if (mainContentWrapper) {
                    originalMainContentWrapperStyles.margin = mainContentWrapper.style.margin;
                    originalMainContentWrapperStyles.padding = mainContentWrapper.style.padding;
                    originalMainContentWrapperStyles.boxShadow = mainContentWrapper.style.boxShadow;
                    originalMainContentWrapperStyles.backgroundColor = mainContentWrapper.style.backgroundColor;
                    originalMainContentWrapperStyles.width = mainContentWrapper.style.width;
                    originalMainContentWrapperStyles.maxWidth = mainContentWrapper.style.maxWidth;
                }

                const originalBodyStyles = {
                    paddingTop: document.body.style.paddingTop,
                    paddingBottom: document.body.style.paddingBottom,
                    backgroundColor: document.body.style.backgroundColor
                };

                const overallMaturityBar = document.getElementById('overallMaturityBar');
                const originalOverallMaturityBarStyles = {};
                if (overallMaturityBar) {
                    originalOverallMaturityBarStyles.webkitPrintColorAdjust = overallMaturityBar.style.webkitPrintColorAdjust;
                    originalOverallMaturityBarStyles.printColorAdjust = overallMaturityBar.style.printColorAdjust;
                }
                
                // New: Store original styles for overallMaturityResultsCard and radarChartResultsCard
                const originalOverallMaturityResultsCardStyles = {};
                if (overallMaturityResultsCard) {
                    originalOverallMaturityResultsCardStyles.display = overallMaturityResultsCard.style.display;
                    originalOverallMaturityResultsCardStyles.width = overallMaturityResultsCard.style.width;
                    originalOverallMaturityResultsCardStyles.flex = overallMaturityResultsCard.style.flex;
                    originalOverallMaturityResultsCardStyles.padding = overallMaturityResultsCard.style.padding;
                    originalOverallMaturityResultsCardStyles.backgroundColor = overallMaturityResultsCard.style.backgroundColor;
                    originalOverallMaturityResultsCardStyles.boxShadow = overallMaturityResultsCard.style.boxShadow;
                }

                const originalRadarChartResultsCardStyles = {};
                if (radarChartResultsCard) {
                    originalRadarChartResultsCardStyles.display = radarChartResultsCard.style.display;
                    originalRadarChartResultsCardStyles.width = radarChartResultsCard.style.width;
                    originalRadarChartResultsCardStyles.flex = radarChartResultsCard.style.flex;
                    originalRadarChartResultsCardStyles.padding = radarChartResultsCard.style.padding;
                    originalRadarChartResultsCardStyles.backgroundColor = radarChartResultsCard.style.backgroundColor;
                    originalRadarChartResultsCardStyles.boxShadow = radarChartResultsCard.style.boxShadow;
                }

                // New: Store original styles for allCategoryResultsCard
                const originalAllCategoryResultsCardStyles = {};
                if (allCategoryResultsCard) {
                    originalAllCategoryResultsCardStyles.display = allCategoryResultsCard.style.display;
                    originalAllCategoryResultsCardStyles.width = allCategoryResultsCard.style.width;
                    originalAllCategoryResultsCardStyles.flex = allCategoryResultsCard.style.flex;
                    originalAllCategoryResultsCardStyles.padding = allCategoryResultsCard.style.padding;
                    originalAllCategoryResultsCardStyles.backgroundColor = allCategoryResultsCard.style.backgroundColor;
                    originalAllCategoryResultsCardStyles.boxShadow = allCategoryResultsCard.style.boxShadow;
                }


                const maturityRadarChartElement = document.getElementById('maturityRadarChart');
                const originalMaturityRadarChartElementStyles = {};
                if (maturityRadarChartElement) {
                    originalMaturityRadarChartElementStyles.width = maturityRadarChartElement.style.width;
                    originalMaturityRadarChartElementStyles.height = maturityRadarChartElement.style.height;
                    originalMaturityRadarChartElementStyles.maxWidth = maturityRadarChartElement.style.maxWidth;
                }

                const overallMaturityBarLabels = document.querySelectorAll('.max-w-6xl.w-full > .relative.w-full.h-auto.mt-2 > span');
                const originalOverallMaturityBarLabelStyles = new Map();
                overallMaturityBarLabels.forEach(el => {
                    originalOverallMaturityBarLabelStyles.set(el, {
                        fontSize: el.style.fontSize
                    });
                });

                // New: Store original styles for categoryCardsWrapper
                const categoryCardsWrapperElement = document.getElementById('categoryCardsWrapper');
                const originalCategoryCardsWrapperStyles = {};
                if (categoryCardsWrapperElement) {
                    originalCategoryCardsWrapperStyles.display = categoryCardsWrapperElement.style.display;
                    originalCategoryCardsWrapperStyles.flexWrap = categoryCardsWrapperElement.style.flexWrap;
                    originalCategoryCardsWrapperStyles.justifyContent = categoryCardsWrapperElement.style.justifyContent;
                    originalCategoryCardsWrapperStyles.gap = categoryCardsWrapperElement.style.gap;
                    originalCategoryCardsWrapperStyles.flexDirection = categoryCardsWrapperElement.style.flexDirection; // New
                    originalCategoryCardsWrapperStyles.alignItems = categoryCardsWrapperElement.style.alignItems; // New
                }
                const categoryCardElements = document.querySelectorAll('#categoryCardsWrapper > div');
                const originalCategoryCardStyles = new Map();
                categoryCardElements.forEach(el => {
                    originalCategoryCardStyles.set(el, {
                        width: el.style.width,
                        minWidth: el.style.minWidth,
                        padding: el.style.padding,
                        backgroundColor: el.style.backgroundColor,
                        boxShadow: el.style.boxShadow,
                        textAlign: el.style.textAlign,
                        // Capture styles for the inner divs
                        nameDivWidth: el.querySelector('.w-\\[70\\%\\]').style.width, // Updated to 70%
                        nameDivTextAlign: el.querySelector('.w-\\[70\\%\\]').style.textAlign, // Updated to left
                        nameH4FontSize: el.querySelector('.w-\\[70\\%\\] h4').style.fontSize, // Updated to 70%
                        levelAndProgressBarWrapperWidth: el.querySelector('.w-\\[30\\%\\]').style.width, // New element
                        levelAndProgressBarWrapperJustifyContent: el.querySelector('.w-\\[30\\%\\]').style.justifyContent, // New element
                        levelSpanFontSize: el.querySelector('.w-\\[30\\%\\] span').style.fontSize, // New element
                        progressBarContainerWidth: el.querySelector('.w-\\[30\\%\\] .flex-grow').style.width, // Updated to flex-grow
                    });
                });
                const categoryCardBarElements = document.querySelectorAll('#categoryCardsWrapper .h-3.rounded-full');
                const originalCategoryCardBarStyles = new Map();
                categoryCardBarElements.forEach(el => {
                    originalCategoryCardBarStyles.set(el, {
                        webkitPrintColorAdjust: el.style.webkitPrintColorAdjust,
                        printColorAdjust: el.style.printColorAdjust
                    });
                });
                const categoryCardTickElements = document.querySelectorAll('#categoryCardsWrapper .absolute.h-4.w-0\\.5.bg-gray-400');
                const originalCategoryCardTickStyles = new Map();
                categoryCardTickElements.forEach(el => {
                    originalCategoryCardTickStyles.set(el, {
                        height: el.style.height,
                        width: el.style.width,
                        backgroundColor: el.style.backgroundColor
                    });
                });

                // New: Store overall maturity description visibility and arrow state
                const originalOverallMaturityDescriptionDisplay = overallMaturityDescription.style.display;
                const originalToggleArrowInnerHTML = toggleArrow.innerHTML;
                const originalToggleArrowClasses = toggleArrow.className; // Store original classes

                // New: Store original display of new title and date elements
                const originalAssessmentToolTitleDisplay = assessmentToolTitle.style.display;
                const originalAssessmentDateDisplay = assessmentDate.style.display;


                // Apply styles specifically for html2canvas capture
                resultsSection.style.display = 'block';
                resultsSection.style.visibility = 'visible';
                resultsSection.style.position = 'relative';
                resultsSection.style.left = '0';
                resultsSection.style.top = '0';
                resultsSection.style.width = '100%';
                resultsSection.style.maxWidth = '800px'; // Set a max-width for better image proportion
                resultsSection.style.margin = 'auto'; // Center the content
                resultsSection.style.padding = '20px'; // Add some padding
                resultsSection.style.boxShadow = 'none';
                resultsSection.style.backgroundColor = '#fff'; // White background for the image

                document.getElementById('printTitle').style.display = 'block';

                if (mainContentWrapper) {
                    mainContentWrapper.style.margin = '0';
                    mainContentWrapper.style.padding = '0';
                    mainContentWrapper.style.boxShadow = 'none';
                    mainContentWrapper.style.backgroundColor = 'transparent';
                    mainContentWrapper.style.width = '100%';
                    mainContentWrapper.style.maxWidth = 'none';
                }

                document.body.style.paddingTop = '0';
                document.body.style.paddingBottom = '0';
                document.body.style.backgroundColor = '#fff';

                if (overallMaturityBar) {
                    overallMaturityBar.style.webkitPrintColorAdjust = 'exact';
                    overallMaturityBar.style.printColorAdjust = 'exact';
                }
                
                // Apply styles for overallMaturityResultsCard and radarChartResultsCard for image capture
                if (overallMaturityResultsCard) {
                    overallMaturityResultsCard.style.display = 'block'; // Ensure block display
                    overallMaturityResultsCard.style.width = '100%';
                    overallMaturityResultsCard.style.flex = 'none';
                    overallMaturityResultsCard.style.padding = '24px'; // Consistent padding
                    overallMaturityResultsCard.style.backgroundColor = '#f7fafc'; // Light gray background
                    overallMaturityResultsCard.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                }

                if (radarChartResultsCard) {
                    radarChartResultsCard.style.display = 'flex'; // Ensure flex for centering canvas
                    radarChartResultsCard.style.width = '100%';
                    radarChartResultsCard.style.flex = 'none';
                    radarChartResultsCard.style.padding = '24px'; // Consistent padding
                    radarChartResultsCard.style.backgroundColor = '#f7fafc'; // Light gray background
                    radarChartResultsCard.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                    radarChartResultsCard.style.justifyContent = 'center'; // Center canvas horizontally
                    radarChartResultsCard.style.alignItems = 'center'; // Center canvas vertically
                }

                // Apply styles for allCategoryResultsCard for image capture
                if (allCategoryResultsCard) {
                    allCategoryResultsCard.style.display = 'block'; // Ensure block display
                    allCategoryResultsCard.style.width = '100%';
                    allCategoryResultsCard.style.flex = 'none';
                    allCategoryResultsCard.style.padding = '24px'; // Consistent padding
                    allCategoryResultsCard.style.backgroundColor = '#f7fafc'; // Light gray background
                    allCategoryResultsCard.style.boxShadow = '0 2px 4px rgba(0,0,0,0.05)';
                }


                if (maturityRadarChartElement) {
                    maturityRadarChartElement.style.width = '100%';
                    maturityRadarChartElement.style.height = 'auto';
                    maturityRadarChartElement.style.maxWidth = '350px'; // Larger chart size for image
                }

                overallMaturityBarLabels.forEach(el => {
                    el.style.fontSize = '0.7em'; // Adjust font size for image
                });

                // Apply styles for categoryCardsWrapper and its children for image capture
                if (categoryCardsWrapperElement) {
                    categoryCardsWrapperElement.style.display = 'flex';
                    categoryCardsWrapperElement.style.flexWrap = 'nowrap'; // Prevent wrapping
                    categoryCardsWrapperElement.style.flexDirection = 'column'; // Stack vertically
                    categoryCardsWrapperElement.style.alignItems = 'flex-start'; // Align items to start (left)
                    categoryCardsWrapperElement.style.justifyContent = 'flex-start'; // Align content to start (top)
                    categoryCardsWrapperElement.style.gap = '4px'; // Adjust gap for image capture (tighter)
                }
                categoryCardElements.forEach(el => {
                    el.style.width = '100%'; // Full width for single column within the allCategoryResultsCard
                    el.style.minWidth = '200px'; // Ensure min width
                    el.style.padding = '8px'; // Reduced padding further for tighter look
                    el.style.backgroundColor = '#f7fafc'; // Light gray background for cards
                    el.style.boxShadow = '0 1px 2px rgba(0,0,0,0.05)'; // Lighter shadow
                    
                    // Apply specific widths and alignment to inner divs
                    el.querySelector('.w-\\[70\\%\\]').style.width = '70%';
                    el.querySelector('.w-\\[70\\%\\]').style.textAlign = 'left';
                    el.querySelector('.w-\\[70\\%\\] h4').style.fontSize = '1em';

                    el.querySelector('.w-\\[30\\%\\]').style.width = '30%';
                    el.querySelector('.w-\\[30\\%\\]').style.justifyContent = 'flex-start'; // Align content to start
                    el.querySelector('.w-\\[30\\%\\] span').style.fontSize = '1em'; // Adjusted font size
                    el.querySelector('.w-\\[30\\%\\] .flex-grow').style.width = 'auto'; // Let it grow
                });
                categoryCardBarElements.forEach(el => {
                    el.style.webkitPrintColorAdjust = 'exact';
                    el.style.printColorAdjust = 'exact';
                });
                categoryCardTickElements.forEach(el => {
                    const originalStyles = originalCategoryCardTickStyles.get(el);
                    el.style.height = originalStyles.height;
                    el.style.width = originalStyles.width;
                    el.style.backgroundColor = originalStyles.backgroundColor;
                });

                // Ensure description is visible for capture
                overallMaturityDescription.classList.remove('hidden');
                toggleArrow.innerHTML = '&#9650;'; // Set to up arrow for capture
                toggleArrow.classList.remove('text-green-700'); // Remove green color if present
                toggleArrow.classList.add('text-gray-500'); // Add gray color

                // Show new title and date elements for capture
                assessmentToolTitle.style.display = 'block';
                assessmentDate.style.display = 'block';


                try {
                    const canvas = await html2canvas(resultsSection, {
                        scale: 2, // Increase scale for higher resolution
                        useCORS: true, // Important for images loaded from different origins (though none here)
                        logging: false // Disable console logging from html2canvas
                    });

                    const imageDataURL = canvas.toDataURL('image/png');
                    
                    // Create a temporary link element to trigger download
                    const link = document.createElement('a');
                    link.download = `${innNameInput.value.trim() || '民宿'}永續旅遊成熟度評估結果.png`;
                    link.href = imageDataURL;
                    document.body.appendChild(link); // Append to body (required for Firefox)
                    link.click(); // Programmatically click the link
                    document.body.removeChild(link); // Remove the link

                } catch (error) {
                    console.error('Error generating image for download:', error);
                    showMessageBox('生成圖片失敗', '無法生成圖片。請稍後再試。');
                } finally {
                    // Restore original display styles for all hidden elements
                    elementsToHideForCapture.forEach(el => {
                        if (el) el.style.display = originalDisplayStyles.get(el);
                    });

                    // Restore original styles for resultsSection
                    resultsSection.style.display = originalResultsSectionStyles.display;
                    resultsSection.style.visibility = originalResultsSectionStyles.visibility;
                    resultsSection.style.position = originalResultsSectionStyles.position;
                    resultsSection.style.left = originalResultsSectionStyles.left;
                    resultsSection.style.top = originalResultsSectionStyles.top;
                    resultsSection.style.width = originalResultsSectionStyles.width;
                    resultsSection.style.maxWidth = originalResultsSectionStyles.maxWidth;
                    resultsSection.style.margin = originalResultsSectionStyles.margin;
                    resultsSection.style.padding = originalResultsSectionStyles.padding;
                    resultsSection.style.boxShadow = originalResultsSectionStyles.boxShadow;
                    resultsSection.style.backgroundColor = originalResultsSectionStyles.backgroundColor;

                    // Hide print title
                    document.getElementById('printTitle').style.display = 'none';

                    // Restore main content wrapper styles
                    if (mainContentWrapper) {
                        mainContentWrapper.style.margin = originalMainContentWrapperStyles.margin;
                        mainContentWrapper.style.padding = originalMainContentWrapperStyles.padding;
                        mainContentWrapper.style.boxShadow = originalMainContentWrapperStyles.boxShadow;
                        mainContentWrapper.style.backgroundColor = originalMainContentWrapperStyles.backgroundColor;
                        mainContentWrapper.style.width = originalMainContentWrapperStyles.width;
                        mainContentWrapper.style.maxWidth = originalMainContentWrapperStyles.maxWidth;
                    }

                    // Restore body padding
                    document.body.style.paddingTop = originalBodyStyles.paddingTop;
                    document.body.style.paddingBottom = originalBodyStyles.paddingBottom;
                    document.body.style.backgroundColor = originalBodyStyles.backgroundColor;

                    // Restore print-color-adjust
                    if (overallMaturityBar) {
                        overallMaturityBar.style.webkitPrintColorAdjust = originalOverallMaturityBarStyles.webkitPrintColorAdjust;
                        overallMaturityBar.style.printColorAdjust = originalOverallMaturityBarStyles.printColorAdjust;
                    }
                    
                    // Restore overallMaturityResultsCard and radarChartResultsCard styles
                    if (overallMaturityResultsCard) {
                        overallMaturityResultsCard.style.display = originalOverallMaturityResultsCardStyles.display;
                        overallMaturityResultsCard.style.width = originalOverallMaturityResultsCardStyles.width;
                        overallMaturityResultsCard.style.flex = originalOverallMaturityResultsCardStyles.flex;
                        overallMaturityResultsCard.style.padding = originalOverallMaturityResultsCardStyles.padding;
                        overallMaturityResultsCard.style.backgroundColor = originalOverallMaturityResultsCardStyles.backgroundColor;
                        overallMaturityResultsCard.style.boxShadow = originalOverallMaturityResultsCardStyles.boxShadow;
                    }

                    if (radarChartResultsCard) {
                        radarChartResultsCard.style.display = originalRadarChartResultsCardStyles.display;
                        radarChartResultsCard.style.width = originalRadarChartResultsCardStyles.width;
                        radarChartResultsCard.style.flex = originalRadarChartResultsCardStyles.flex;
                        radarChartResultsCard.style.padding = originalRadarChartResultsCardStyles.padding;
                        radarChartResultsCard.style.backgroundColor = originalRadarChartResultsCardStyles.backgroundColor;
                        radarChartResultsCard.style.boxShadow = originalRadarChartResultsCardStyles.boxShadow;
                        radarChartResultsCard.style.justifyContent = ''; // Clear flex properties
                        radarChartResultsCard.style.alignItems = ''; // Clear flex properties
                    }

                    // Restore allCategoryResultsCard styles
                    if (allCategoryResultsCard) {
                        allCategoryResultsCard.style.display = originalAllCategoryResultsCardStyles.display;
                        allCategoryResultsCard.style.width = originalAllCategoryResultsCardStyles.width;
                        allCategoryResultsCard.style.flex = originalAllCategoryResultsCardStyles.flex;
                        allCategoryResultsCard.style.padding = originalAllCategoryResultsCardStyles.padding;
                        allCategoryResultsCard.style.backgroundColor = originalAllCategoryResultsCardStyles.backgroundColor;
                        allCategoryResultsCard.style.boxShadow = originalAllCategoryResultsCardStyles.boxShadow;
                    }

                    // Restore radar chart size
                    if (maturityRadarChartElement) {
                        maturityRadarChartElement.style.width = originalMaturityRadarChartElementStyles.width;
                        maturityRadarChartElement.style.height = originalMaturityRadarChartElementStyles.height;
                        maturityRadarChartElement.style.maxWidth = originalMaturityRadarChartElementStyles.maxWidth;
                    }

                    // Restore overall maturity bar labels font size
                    overallMaturityBarLabels.forEach(el => {
                        el.style.fontSize = originalOverallMaturityBarLabelStyles.get(el).fontSize;
                    });

                    // Restore styles for categoryCardsWrapper and its children
                    if (categoryCardsWrapperElement) {
                        categoryCardsWrapperElement.style.display = originalCategoryCardsWrapperStyles.display;
                        categoryCardsWrapperElement.style.flexWrap = originalCategoryCardsWrapperStyles.flexWrap;
                        categoryCardsWrapperElement.style.justifyContent = originalCategoryCardsWrapperStyles.justifyContent;
                        categoryCardsWrapperElement.style.gap = originalCategoryCardsWrapperStyles.gap;
                        categoryCardsWrapperElement.style.flexDirection = originalCategoryCardsWrapperStyles.flexDirection; // New
                        categoryCardsWrapperElement.style.alignItems = originalCategoryCardsWrapperStyles.alignItems; // New
                    }
                    categoryCardElements.forEach(el => {
                        const originalStyles = originalCategoryCardStyles.get(el);
                        el.style.width = originalStyles.width;
                        el.style.minWidth = originalStyles.minWidth;
                        el.style.padding = originalStyles.padding;
                        el.style.backgroundColor = originalStyles.backgroundColor;
                        el.style.boxShadow = originalStyles.boxShadow;
                        
                        // Restore specific widths and alignment to inner divs
                        el.querySelector('.w-\\[70\\%\\]').style.width = originalStyles.nameDivWidth;
                        el.querySelector('.w-\\[70\\%\\]').style.textAlign = originalStyles.nameDivTextAlign;
                        el.querySelector('.w-\\[70\\%\\] h4').style.fontSize = originalStyles.nameH4FontSize;

                        el.querySelector('.w-\\[30\\%\\]').style.width = originalStyles.levelAndProgressBarWrapperWidth;
                        el.querySelector('.w-\\[30\\%\\]').style.justifyContent = originalStyles.levelAndProgressBarWrapperJustifyContent;
                        el.querySelector('.w-\\[30\\%\\] span').style.fontSize = originalStyles.levelSpanFontSize;
                        el.querySelector('.w-\\[30\\%\\] .flex-grow').style.width = originalStyles.progressBarContainerWidth;
                    });
                    categoryCardBarElements.forEach(el => {
                        const originalStyles = originalCategoryCardBarStyles.get(el);
                        el.style.webkitPrintColorAdjust = originalStyles.webkitPrintColorAdjust;
                        el.style.printColorAdjust = originalStyles.printColorAdjust;
                    });
                    categoryCardTickElements.forEach(el => {
                        const originalStyles = originalCategoryCardTickStyles.get(el);
                        el.style.height = originalStyles.height;
                        el.style.width = originalStyles.width;
                        el.style.backgroundColor = originalStyles.backgroundColor;
                    });

                    // Restore overall maturity description visibility and arrow state and classes
                    overallMaturityDescription.classList.toggle('hidden', originalOverallMaturityDescriptionDisplay === 'none');
                    toggleArrow.innerHTML = originalToggleArrowInnerHTML;
                    toggleArrow.className = originalToggleArrowClasses; // Restore original classes

                    // Hide new title and date elements
                    assessmentToolTitle.style.display = originalAssessmentToolTitleDisplay;
                    assessmentDate.style.display = originalAssessmentDateDisplay;


                    // Hide loading message
                    messageBox.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
